define("lytix_helper/widget",["exports","core/ajax","core/log","core/str"],(function(_exports,_ajax,_log,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_log=_interopRequireDefault(_log),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);class WidgetError extends Error{constructor(message,stringKey){super(message),this.name="WidgetError",this.stringKey=stringKey}}var _default={NoDataError:class extends WidgetError{constructor(){super("Not enough data available.","no_data_available")}},handleError:(error,widgetId)=>{const widgetContent=document.querySelector("#"+widgetId+" .content");widgetContent.classList.add("widget-error"),widgetContent.innerHTML="";const frag=document.createDocumentFragment(),span=document.createElement("span"),insertMessage=message=>{span.innerText=message,frag.appendChild(span),widgetContent.appendChild(frag)};Str.get_string(error.stringKey||"generic_error","lytix_helper").then((string=>insertMessage(string))).catch((error=>{insertMessage("Something went wrong. Please try reloading or report this incident if the error persists."),_log.default.debug("Some supplied data could probably not be processed correctly.",error)})),widgetContent.removeAttribute("hidden"),_log.default.debug(error)},getStrings:data=>{const components=Object.keys(data),requests=[],referenceKeys=[],lengths=[];for(const componentName of components){const component=data[componentName];if("identical"in component){const keys=component.identical,length=keys.length;for(let i=0;i<length;++i)requests.push({key:keys[i],component:componentName});referenceKeys.push(keys),lengths.push(keys.length)}if("differing"in component){const differing=component.differing,objectKeys=Object.keys(differing),length=objectKeys.length;for(let i=0;i<length;++i)requests.push({key:differing[objectKeys[i]],component:componentName});referenceKeys.push(objectKeys),lengths.push(objectKeys.length)}}return Str.get_strings(requests).then((strings=>{const result={},count=lengths.length;let stringIndex=0;for(let i=0;i<count;++i){const length=lengths[i],keys=referenceKeys[i];for(let j=0;j<length;++j)result[keys[j]]=strings[stringIndex++]}return result})).catch((error=>{throw _log.default.debug(error),error.stringKey="fetch_failed",error}))},getData:(methodname,args)=>_ajax.default.call([{methodname:methodname,args:args}])[0].then((data=>data)).catch((error=>{throw error.stringKey="fetch_failed",error})),convertLocale:locale=>locale.substring(0,locale.indexOf(".")).replace("_","-"),getContentContainer:widgetId=>document.querySelector("#"+widgetId+" .content")};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=widget.min.js.map